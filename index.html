<!DOCTYPE html>
<html lang="en">
 <head>
   <link href="/bootstrap-3.3.4-dist/css/bootstrap.css" rel="stylesheet">
   <style>
    body { padding-top: 10px; padding-left: 30px; }
   </style>
 </head>
<body>
<h1>Сервис деплоя</h1>
<b>1. Выберите сервис:</b>
<script src="/jquery-1.11.2.js"></script>
<script src="/bootstrap-3.3.4-dist/js/bootstrap.js"></script>
<script>

var a = '';
var b = '';
//var dir = '';
var el = $(document);
console.debug(el);

$.getJSON('/list_s', function(data) {
 var items = [];
 $.each(data, function(key, val) {
   items.push('<div class="radio"> <label>');
   items.push('<input type="radio" class="serviceType" name="optionsRadios" id="optionsRadios' + key + '" value="' + val + '" >');
   items.push(val);
   items.push('</label></div>');
 });
 $('<div/>', {
  // 'class': '',
   html: items.join('')
 }).appendTo('body');
});


$(function(){
  $(document).on('click', '.serviceType', function(){
    $( ".releaseslist" ).remove();
    $( ".serversToDeploylist" ).remove();
    $( ".result" ).remove();
    if ($(this).is(':checked'))
    {
      a = $(this).val();
      $.getJSON('/list_r?service_dir=' + $(this).val(), function(data) {
       var items = [];
       items.push('<b>2. Выберите релиз:</b>')
       $.each(data, function(key, val) {
         items.push('<div class="radio"> <label>');
         items.push('<input type="radio" class="releaseType" name="optionsRadios" id="optionsRadios' + key + '" value="' + val + '" >');
         items.push(val);
         items.push('</label></div>');
       });
       $('<div/>', {
         'class': 'releaseslist',
         html: items.join('')
       }).appendTo('body');
      });
    }
  });
});


$(function(){
  $(document).on('click', '.releaseType', function(){
    $( ".serversToDeploylist" ).remove();
    $( ".result" ).remove();
    if ($(this).is(':checked'))
    {
      b = $(this).val();
      $.getJSON('/list_serverstodeploy?service_dir=' + a, function(data) {
       var items = [];
       items.push('<b>2. Выберите сервер куда выложить релиз:</b>')
       $.each(data, function(key, val) {
         items.push('<div class="radio"> <label>');
         items.push('<input type="radio" class="serversToDeployType" name="optionsRadios" id="optionsRadios' + key + '" value="' + val + '" >');
         items.push(val);
         items.push('</label></div>');
       });
       $('<div/>', {
         'class': 'serversToDeploylist',
         html: items.join('')
       }).appendTo('body');
      });
    }
  });
});


$(function(){
  $(document).on('click', '.serversToDeployType', function(){
  $( ".result" ).remove();
  if ($(this).is(':checked'))
    {
      c = $(this).val();
      $.get('/web_do?service_dir=' + a + '&release_dir=' + b, '&servers_to_deploy=' + c, function(data) {
        plainData = data.replace(/\t/g, '    ') // Заменяет символы перевода строки на html теги
                        .replace(/  /g, '&nbsp; ')
                        .replace(/  /g, ' &nbsp;')
                        .replace(/\r\n|\n|\r/g, '<br />');
      $('<kbd/>', {
        'class': 'result',
        html:plainData
      }).appendTo('body');
      });
      //fab upload_to_server:release=20150725T115311
    }
  });
});


</script>
</body>
</html>
